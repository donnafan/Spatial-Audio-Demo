  <!doctype html>
  <html lang="en">

  <head>
    <meta charset="utf-8">
    <title>Virtual 3D Sound</title>
    <meta name="description" content="Virtual 3D Sound Simulation">
    <meta name="author" content="Donna Fan">
  </head>

  <body>
    <script src="js/hrtf.js"></script>
    <div id="container"></div>
    <script type="module">
        
        let audioElement;
        let audioContext;
        // load hrir to the container
        var hrtfContainer = new HRTFContainer();
        hrtfContainer.loadHrir("hrir/subject_003.bin");
        audioElement = new Audio("roundabout.mp3");
        audioContext = new AudioContext();
        const audioSource = audioContext.createMediaElementSource(audioElement);
        var gain = audioContext.createGain();
        gain.gain.value = 0.5;
        audioSource.connect(gain, 0);
        // create new hrtf panner, source node gets connected automatically
        var panner = new HRTFPanner(audioContext, gain, hrtfContainer);
        panner.connect(audioContext.destination);
        audioElement.play();



      import * as THREE from './build/three.module.js';
      import { OrbitControls } from './jsm/controls/OrbitControls.js';
      import { GLTFLoader } from './jsm/loaders/GLTFLoader.js';

      var container = document.getElementById('container');

      var renderer, scene, camera, stats;
      var mesh;
      let x1, x2, x3
      var textureLoader = new THREE.TextureLoader();

      window.addEventListener('load', init);

      function init() {

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.z = 200;
        camera.target = new THREE.Vector3();

        var controls = new OrbitControls(camera, renderer.domElement);
        controls.minDistance = 200;
        controls.maxDistance = 200;

        scene.add(new THREE.AmbientLight(0x443333));

        var light = new THREE.DirectionalLight(0xffddcc, 1);
        light.position.set(1, 0.75, 0.5);
        scene.add(light);

        var light = new THREE.DirectionalLight(0xccccff, 1);
        light.position.set(- 1, 0.75, - 0.5);
        scene.add(light);

        var geometry = new THREE.BufferGeometry();
        geometry.setFromPoints([new THREE.Vector3(), new THREE.Vector3()]);

        loadLeePerrySmith();

        window.addEventListener('resize', onWindowResize, false);
        onWindowResize();
        animate();

      }

      function loadLeePerrySmith() {

        var loader = new GLTFLoader();

        loader.load('models/gltf/LeePerrySmith/LeePerrySmith.glb', function (gltf) {

          mesh = gltf.scene.children[0];
          scene.add(mesh);
          mesh.scale.set(10, 10, 10);

        });

      }

      function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);

      }

      function animate() {

        requestAnimationFrame(animate);

        renderer.render(scene, camera);
        x1 = -1 * camera.position.x;
        x2 = camera.position.z;
        x3 = camera.position.y;
        var cords = cartesianToInteraural(x1,x2,x3);
		    panner.update(cords.azm, cords.elv);
      }



    </script>

  </body>

  </html>